<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pvl_calcparams_desoto &mdash; PV LIB 1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="PV LIB 1.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">PV LIB 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pvl_calcparams_desoto</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pvl_tools</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>


<span class="k">def</span> <span class="nf">pvl_calcparams_desoto</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">Tcell</span><span class="p">,</span><span class="n">alpha_isc</span><span class="p">,</span><span class="n">ModuleParameters</span><span class="p">,</span><span class="n">EgRef</span><span class="p">,</span><span class="n">dEgdT</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Sref</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">Tref</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<div class="viewcode-block" id="pvl_calcparams_desoto"><a class="viewcode-back" href="../stubs/pvl_calcparams_desoto.pvl_calcparams_desoto.html#pvl_calcparams_desoto.pvl_calcparams_desoto">[docs]</a><span class="sd">  Applies the temperature and irradiance corrections to inputs for pvl_singlediode</span>
<span class="sd">  </span>
<span class="sd">   Applies the temperature and irradiance corrections to the IL, I0, </span>
<span class="sd">   Rs, Rsh, and a parameters at reference conditions (IL_ref, I0_ref,</span>
<span class="sd">   etc.) according to the De Soto et. al description given in [1]. The</span>
<span class="sd">   results of this correction procedure may be used in a single diode</span>
<span class="sd">   model to determine IV curves at irradiance = S, cell temperature =</span>
<span class="sd">   Tcell.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  S : float or DataFrame</span>
<span class="sd">        The irradiance (in W/m^2) absorbed by the module. S must be &gt;= 0.</span>
<span class="sd">        Due to a division by S in the script, any S value equal to 0 will be set to 1E-10.</span>
<span class="sd">    </span>
<span class="sd">  Tcell : float or DataFrame </span>
<span class="sd">        The average cell temperature of cells within a module in C.</span>
<span class="sd">        Tcell must be &gt;= -273.15. </span>

<span class="sd">  alpha_isc : float</span>

<span class="sd">        The short-circuit current temperature coefficient of the module in units of 1/C.</span>
<span class="sd"> </span>
<span class="sd">  ModuleParameters : struct</span>
<span class="sd">        parameters describing PV module performance at reference conditions according </span>
<span class="sd">        to DeSoto&#39;s paper. Parameters may be generated or found by lookup. For ease of use, </span>
<span class="sd">        PVL_RETREIVESAM can automatically generate a struct based on the most recent SAM CEC module </span>
<span class="sd">        database. The ModuleParameters struct must contain (at least) the </span>
<span class="sd">        following 5 fields:</span>

<span class="sd">            *ModuleParameters.a_ref* - modified diode ideality factor parameter at</span>
<span class="sd">                reference conditions (units of eV), a_ref can be calculated from the</span>
<span class="sd">                usual diode ideality factor (n), number of cells in series (Ns),</span>
<span class="sd">                and cell temperature (Tcell) per equation (2) in [1].</span>
<span class="sd">        </span>
<span class="sd">            *ModuleParameters.IL_ref* - Light-generated current (or photocurrent) </span>
<span class="sd">                in amperes at reference conditions. This value is referred to </span>
<span class="sd">                as Iph in some literature.</span>
<span class="sd">        </span>
<span class="sd">            *ModuleParameters.I0_ref* - diode reverse saturation current in amperes, </span>
<span class="sd">                under reference conditions.</span>
<span class="sd">        </span>
<span class="sd">            *ModuleParameters.Rsh_ref* - shunt resistance under reference conditions (ohms)</span>
<span class="sd">        </span>
<span class="sd">            *ModuleParameters.Rs_ref* - series resistance under reference conditions (ohms)</span>

<span class="sd">  EgRef : float</span>

<span class="sd">        The energy bandgap at reference temperature (in eV). 1.121 eV for silicon. EgRef must be &gt;0.</span>
<span class="sd">  </span>
<span class="sd">  dEgdT : float</span>

<span class="sd">        The temperature dependence of the energy bandgap at SRC (in 1/C).</span>
<span class="sd">        May be either a scalar value (e.g. -0.0002677 as in [1]) or a</span>
<span class="sd">        DataFrame of dEgdT values corresponding to each input condition (this</span>
<span class="sd">        may be useful if dEgdT is a function of temperature).</span>

<span class="sd">  Other Parameters</span>
<span class="sd">  ----------------</span>

<span class="sd">  M : float or DataFrame (optional, Default=1)</span>

<span class="sd">        An optional airmass modifier, if omitted, M is given a value of 1,</span>
<span class="sd">        which assumes absolute (pressure corrected) airmass = 1.5. In this</span>
<span class="sd">        code, M is equal to M/Mref as described in [1] (i.e. Mref is assumed</span>
<span class="sd">        to be 1). Source [1] suggests that an appropriate value for M</span>
<span class="sd">        as a function absolute airmass (AMa) may be:</span>

<span class="sd">        &gt;&gt;&gt; M = np.polyval([-0.000126, 0.002816, -0.024459, 0.086257, 0.918093], AMa)</span>
<span class="sd">        </span>
<span class="sd">        M may be a DataFrame.</span>

<span class="sd">  Sref : float (optional, Default=1000)</span>

<span class="sd">        Optional reference irradiance in W/m^2. If omitted, a value of</span>
<span class="sd">        1000 is used.</span>

<span class="sd">  Tref : float (Optional, Default=25)</span>
<span class="sd">        Optional reference cell temperature in C. If omitted, a value of</span>
<span class="sd">        25 C is used.</span>

<span class="sd">  Returns</span>
<span class="sd">  --------</span>

<span class="sd">   IL : float or DataFrame </span>
<span class="sd">        Light-generated current in amperes at irradiance=S and </span>
<span class="sd">        cell temperature=Tcell. </span>
<span class="sd">   I0 : float or DataFrame </span>
<span class="sd">        Diode saturation curent in amperes at irradiance S and cell temperature Tcell. </span>

<span class="sd">   Rs : float</span>
<span class="sd">        Series resistance in ohms at irradiance S and cell temperature Tcell.</span>

<span class="sd">   Rsh : float or DataFrame </span>
<span class="sd">        Shunt resistance in ohms at irradiance S and cell temperature Tcell.</span>
<span class="sd">   </span>
<span class="sd">   nNsVth : float or DataFrame </span>
<span class="sd">        Modified diode ideality factor at irradiance S and cell temperature</span>
<span class="sd">        Tcell. Note that in source [1] nNsVth = a (equation 2). nNsVth is the </span>
<span class="sd">        product of the usual diode ideality factor (n), the number of </span>
<span class="sd">        series-connected cells in the module (Ns), and the thermal voltage </span>
<span class="sd">        of a cell in the module (Vth) at a cell temperature of Tcell.</span>



<span class="sd">  References</span>
<span class="sd">  ----------</span>

<span class="sd">  [1] W. De Soto et al., &quot;Improvement and validation of a model for</span>
<span class="sd">     photovoltaic array performance&quot;, Solar Energy, vol 80, pp. 78-88,</span>
<span class="sd">     2006.</span>

<span class="sd">  [2] System Advisor Model web page. https://sam.nrel.gov.</span>

<span class="sd">  [3] A. Dobos, &quot;An Improved Coefficient Calculator for the California</span>
<span class="sd">     Energy Commission 6 Parameter Photovoltaic Module Model&quot;, Journal of</span>
<span class="sd">     Solar Energy Engineering, vol 134, 2012.</span>

<span class="sd">  [4] O. Madelung, &quot;Semiconductors: Data Handbook, 3rd ed.&quot; ISBN</span>
<span class="sd">     3-540-40488-0</span>

<span class="sd">  See Also</span>
<span class="sd">  --------</span>
<span class="sd">  pvl_sapm</span>
<span class="sd">  pvl_sapmcelltemp   </span>
<span class="sd">  pvl_singlediode    </span>
<span class="sd">  pvl_retreivesam</span>

<span class="sd">  </span>
<span class="sd">  Notes</span>
<span class="sd">  -----</span>

<span class="sd">  If the reference parameters in the ModuleParameters struct are read</span>
<span class="sd">  from a database or library of parameters (e.g. System Advisor Model),</span>
<span class="sd">  it is important to use the same EgRef and dEgdT values that</span>
<span class="sd">  were used to generate the reference parameters, regardless of the </span>
<span class="sd">  actual bandgap characteristics of the semiconductor. For example, in </span>
<span class="sd">  the case of the System Advisor Model library, created as described in </span>
<span class="sd">  [3], EgRef and dEgdT for all modules were 1.121 and -0.0002677,</span>
<span class="sd">  respectively.</span>

<span class="sd">  This table of reference bandgap energies (EgRef), bandgap energy</span>
<span class="sd">  temperature dependence (dEgdT), and &quot;typical&quot; airmass response (M) is</span>
<span class="sd">  provided purely as reference to those who may generate their own</span>
<span class="sd">  reference module parameters (a_ref, IL_ref, I0_ref, etc.) based upon the</span>
<span class="sd">  various PV semiconductors. Again, we stress the importance of</span>
<span class="sd">  using identical EgRef and dEgdT when generation reference</span>
<span class="sd">  parameters and modifying the reference parameters (for irradiance,</span>
<span class="sd">  temperature, and airmass) per DeSoto&#39;s equations.</span>

<span class="sd">   Silicon (Si):</span>
<span class="sd">       EgRef = 1.121</span>
<span class="sd">       dEgdT = -0.0002677</span>

<span class="sd">       &gt;&gt;&gt; M = polyval([-0.000126 0.002816 -0.024459 0.086257 0.918093], AMa)</span>

<span class="sd">       Source = Reference 1</span>

<span class="sd">   Cadmium Telluride (CdTe):</span>
<span class="sd">       EgRef = 1.475</span>
<span class="sd">       dEgdT = -0.0003</span>

<span class="sd">       &gt;&gt;&gt; M = polyval([-2.46E-5 9.607E-4 -0.0134 0.0716 0.9196], AMa)</span>
<span class="sd">       </span>
<span class="sd">       Source = Reference 4</span>

<span class="sd">   Copper Indium diSelenide (CIS):</span>
<span class="sd">       EgRef = 1.010</span>
<span class="sd">       dEgdT = -0.00011</span>

<span class="sd">       &gt;&gt;&gt; M = polyval([-3.74E-5 0.00125 -0.01462 0.0718 0.9210], AMa)</span>

<span class="sd">       Source = Reference 4</span>

<span class="sd">   Copper Indium Gallium diSelenide (CIGS):</span>
<span class="sd">       EgRef = 1.15</span>
<span class="sd">       dEgdT = ????</span>

<span class="sd">       &gt;&gt;&gt; M = polyval([-9.07E-5 0.0022 -0.0202 0.0652 0.9417], AMa)</span>

<span class="sd">       Source = Wikipedia</span>

<span class="sd">   Gallium Arsenide (GaAs):</span>

<span class="sd">       EgRef = 1.424</span>
<span class="sd">       dEgdT = -0.000433</span>
<span class="sd">       M = unknown</span>
<span class="sd">       Source = Reference 4</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">Vars</span><span class="o">=</span><span class="nb">locals</span><span class="p">()</span>

  <span class="n">Expect</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;S&#39;</span><span class="p">:(</span><span class="s">&#39;x &gt;= 0&#39;</span><span class="p">)</span> <span class="p">,</span>
          <span class="s">&#39;Tcell&#39;</span><span class="p">:(</span><span class="s">&#39;x &gt;= - 273.15&#39;</span><span class="p">)</span> <span class="p">,</span>
          <span class="s">&#39;alpha_isc&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
          <span class="s">&#39;ModuleParameters&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
          <span class="s">&#39;EgRef&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;x &gt; 0&#39;</span><span class="p">),</span>
          <span class="s">&#39;dEgdT&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">),</span>
          <span class="s">&#39;M&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;num&#39;</span><span class="p">,</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=1&#39;</span><span class="p">),</span> 
          <span class="s">&#39;Sref&#39;</span><span class="p">:(</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=1000&#39;</span><span class="p">),</span>
          <span class="s">&#39;Tref&#39;</span><span class="p">:(</span><span class="s">&#39;default&#39;</span><span class="p">,</span><span class="s">&#39;default=25&#39;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">var</span><span class="o">=</span><span class="n">pvl_tools</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">Vars</span><span class="p">,</span><span class="n">Expect</span><span class="p">)</span>

  <span class="n">var</span><span class="o">.</span><span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">M</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
  <span class="n">a_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">A_ref</span>
  <span class="n">IL_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">I_l_ref</span>
  <span class="n">I0_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">I_o_ref</span>
  <span class="n">Rsh_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">R_sh_ref</span>
  <span class="n">Rs_ref</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">ModuleParameters</span><span class="o">.</span><span class="n">R_s</span>


  <span class="n">k</span><span class="o">=</span><span class="mf">8.617332478e-05</span>
  <span class="n">Tref_K</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Tref</span> <span class="o">+</span> <span class="mf">273.15</span>
  <span class="n">Tcell_K</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">Tcell</span> <span class="o">+</span> <span class="mf">273.15</span>

  <span class="n">var</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">S</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mf">1e-10</span>
  <span class="n">E_g</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">EgRef</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">dEgdT</span><span class="o">*</span><span class="p">((</span><span class="n">Tcell_K</span> <span class="o">-</span> <span class="n">Tref_K</span><span class="p">))))</span>

  <span class="n">nNsVth</span><span class="o">=</span><span class="n">a_ref</span><span class="o">*</span><span class="p">((</span><span class="n">Tcell_K</span> <span class="o">/</span> <span class="n">Tref_K</span><span class="p">))</span>

  <span class="n">IL</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">S</span> <span class="o">/</span> <span class="n">var</span><span class="o">.</span><span class="n">Sref</span> <span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">M</span><span class="p">)</span> <span class="o">*</span><span class="p">((</span><span class="n">IL_ref</span> <span class="o">+</span> <span class="n">var</span><span class="o">.</span><span class="n">alpha_isc</span> <span class="o">*</span> <span class="p">((</span><span class="n">Tcell_K</span> <span class="o">-</span> <span class="n">Tref_K</span><span class="p">))))</span>
  <span class="n">I0</span><span class="o">=</span><span class="n">I0_ref</span> <span class="o">*</span> <span class="p">(((</span><span class="n">Tcell_K</span> <span class="o">/</span> <span class="n">Tref_K</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">EgRef</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">Tref_K</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">E_g</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">Tcell_K</span><span class="p">)))))</span>
  <span class="n">Rsh</span><span class="o">=</span><span class="n">Rsh_ref</span> <span class="o">*</span> <span class="p">((</span><span class="n">var</span><span class="o">.</span><span class="n">Sref</span> <span class="o">/</span> <span class="n">var</span><span class="o">.</span><span class="n">S</span><span class="p">))</span>
  <span class="n">Rs</span><span class="o">=</span><span class="n">Rs_ref</span>

  <span class="k">return</span> <span class="n">IL</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">Rs</span><span class="p">,</span><span class="n">Rsh</span><span class="p">,</span><span class="n">nNsVth</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">PV LIB 1.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Sandia National Labs.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>